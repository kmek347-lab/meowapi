<!doctype html>

<html lang="en">

<head>

<meta charset="utf-8" />

<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>MeowAPI - Enabled (Dynamic Profile)</title>

<style>

  :root {

    --bg1: #04140d;

    --bg2: #072515;

    --accent: #1dd672;

    --text: #e6ffee;

    --muted: #a8d8bb;

    --glass: rgba(255,255,255,0.06);

    --border: rgba(255,255,255,0.08);

  }



  html, body {

    height: 100%;

    margin: 0;

    font-family: Inter, system-ui, sans-serif;

    background: radial-gradient(circle at top left, var(--bg1), var(--bg2));

    color: var(--text);

  }



  .wrap {

    max-width: 900px;

    margin: 40px auto;

    padding: 20px;

  }



  header {

    display: flex;

    align-items: center;

    gap: 16px;

    margin-bottom: 20px;

  }



  .avatar {

    width: 70px;

    height: 70px;

    border-radius: 14px;

    overflow: hidden;

    background: linear-gradient(135deg, #1b5d3e, #0f261a);

    box-shadow: 0 0 18px rgba(0,0,0,0.5);

  }



  .avatar img {

    width: 100%;

    height: 100%;

    object-fit: cover;

  }



  h1 {

    font-size: 20px;

    margin: 0;

    font-weight: 700;

  }



  .subtitle {

    color: var(--muted);

    font-size: 13px;

    margin-top: 6px;

  }

  

  .subtitle.profile-name {
    color: var(--accent);
    font-weight: 600;
  }


  .card {

    background: var(--glass);

    border: 1px solid var(--border);

    border-radius: 16px;

    padding: 20px;

    margin-bottom: 16px;

    box-shadow: 0 8px 30px rgba(0,0,0,0.4);

    backdrop-filter: blur(25px);

    -webkit-backdrop-filter: blur(25px);

  }



  .input-box {

    display: flex;

    flex-direction: column;

    gap: 15px;

    align-items: flex-start;

  }



  #uuidInput {

    padding: 10px 14px;

    border-radius: 10px;

    border: 1px solid rgba(255,255,255,0.15);

    background: rgba(255,255,255,0.08);

    color: #fff;

    width: 280px;

    outline: none;

    font-size: 14px;

  }



  #uuidInput::placeholder {

    color: rgba(255,255,255,0.3);

  }



  .show-btn {

    background: linear-gradient(135deg, #1dd672 0%, #0fa36b 100%);

    border: none;

    padding: 14px 24px;

    border-radius: 12px;

    color: #0a1b13;

    font-weight: 700;

    font-size: 15px;

    cursor: pointer;

    align-self: center;

    box-shadow: 0 0 10px rgba(29,214,114,0.3), inset 0 1px 0 rgba(255,255,255,0.25);

    transition: all 0.25s ease;

  }



  .show-btn:hover {

    transform: translateY(-2px) scale(1.05);

    box-shadow: 0 0 20px rgba(29,214,114,0.45);

  }



  .muted {

    color: var(--muted);

    font-size: 13px;

    white-space: pre-wrap;

    word-break: break-word;

  }

</style>

</head>

<body>

<div class="wrap">

  <header>

    <div class="avatar">

      <img id="avatarImg" 

           src="https://skin.laby.net/api/render/user/38a27d59-1c8d-4eb2-a27c-530612b07cfb.png?shadow=true&bust=true" 

           alt="avatar" 

           onerror="this.src='https://via.placeholder.com/64/1dd672/FFFFFF?text=?'">

    </div>

    <div>

      <h1 id="oneLine">â€”</h1>

      <div class="subtitle">MeowAPI - Enabled</div>
      <div class="subtitle profile-name" id="profileNameOutput"></div>

    </div>

  </header>



  <div class="card input-box">

    <input type="text" id="uuidInput" placeholder="Enter Username">

    <button class="show-btn" id="refreshBtn">Show Stats</button>

  </div>



  <div class="card">

    <div id="output" class="muted">Enter username above...</div>

  </div>

</div>



<script>

// --- Helper Functions ---

function minecraftColorToHtml(text) {

  const colorMap = {

    '0': '#000000','1': '#0000AA','2': '#00AA00','3': '#00AAAA',

    '4': '#AA0000','5': '#AA00AA','6': '#FFAA00','7': '#AAAAAA',

    '8': '#555555','9': '#5555FF','a': '#55FF55','b': '#55FFFF',

    'c': '#FF5555','d': '#FF55FF','e': '#FFFF55','f': '#FFFFFF'

  };

  if (!text) return "";

  return text

    .replace(/Â§([0-9a-f])/g, (_, c) => `<span style="color:${colorMap[c]||'#fff'}">`)

    .replace(/Â§r/g, '</span>') + '</span>';

}



function addHyphens(uuid) {

  return uuid.replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/, "$1-$2-$3-$4-$5");

}



function cleanName(name) {

  if (!name) return "";
  
  // Regex to remove a wide range of Hypixel/Minecraft symbols
  let cleaned = name.replace(/[âœªâœ¿âœ¦âššâžŽâ˜…â˜†â—†â—‡â– â–¡â—â—‹â—Žâ˜€â˜â˜‚â˜ƒâ˜„â˜¾â˜½â™›â™•â™šâ™”â™¤â™¡â™¢â™§â™ â™¥â™¦â™£âšœâš¡âœ¨â–â¬¥â¬¦â¬§â¬¨â¬©â­ðŸŒŸðŸŸŠâ¶-â¿â“¿-âž“IVXLCá›šâ£]+/g, "").trim();

  // New specific cleanup for common, undesirable prefixes like 'apis'
  cleaned = cleaned.replace(/apis/i, '').trim(); // Remove "apis" regardless of case
  
  return cleaned;

}



function formatCoins(num) {

  if (!isFinite(num)) return "0";
  const numAbs = Math.abs(num);

  // Use standard SI prefixes for large numbers (Quadrillion, Trillion, Billion, Million, Thousand)
  if (numAbs >= 1e15) return (num / 1e15).toFixed(1) + "Q"; // Quadrillion

  if (numAbs >= 1e12) return (num / 1e12).toFixed(1) + "T"; // Trillion

  if (numAbs >= 1e9) return (num / 1e9).toFixed(1) + "B"; // Billion

  if (numAbs >= 1e6) return (num / 1e6).toFixed(1) + "M"; // Million

  if (numAbs >= 1e3) return (num / 1e3).toFixed(0) + "K"; // Thousand (0 decimal for K)

  return Math.floor(num).toString();

}


function getSkillAverage(member) {
  const skills = member.skills || {};
  let totalLevel = 0;
  let skillCount = 0;
  
  // Skill names typically used for skill average calculation
  const skillNames = ["alchemy", "carpentry", "combat", "enchanting", "farming", "fishing", "foraging", "mining", "taming"];
  
  for (const name of skillNames) {
    if (skills[name] && skills[name].levelWithProgress) {
      totalLevel += skills[name].levelWithProgress;
      skillCount++;
    }
  }
  
  return skillCount > 0 ? (totalLevel / skillCount) : 0;
}


// Base64 encoding function
function encodeBase64Payload(username, profileName) {
    const payload = [{"uuid":1,"profileId":2}, username, profileName];
    const jsonString = JSON.stringify(payload);
    let encoded = btoa(jsonString);

    while (encoded.endsWith('=')) {
        encoded = encoded.slice(0, -1);
    }
    
    return encoded;
}


// --- Main Fetch Function ---
async function fetchStats() {

  const input = document.getElementById('uuidInput');
  const avatarImg = document.getElementById('avatarImg');
  const oneLine = document.getElementById('oneLine');
  const out = document.getElementById('output');
  const profileNameOutput = document.getElementById('profileNameOutput');
  const username = input.value.trim();



  if (!username) {

    out.textContent = "âš ï¸ Enter a username.";
    profileNameOutput.textContent = "";
    return;

  }



  out.textContent = "Fetching data and finding best profile...";
  oneLine.textContent = "Loading...";
  profileNameOutput.textContent = "";



  try {

    // 1. Fetch Hypixel Player Data (to get UUID and minigame stats)
    const playerRes = await fetch(`https://api.soopy.dev/player/${encodeURIComponent(username)}`);
    const playerJson = await playerRes.json();
    if (!playerJson.success || !playerJson.data) throw new Error("Invalid player data or API error.");



    const uuidRaw = playerJson.data.uuid || "";
    const uuid = uuidRaw.replace(/-/g, "");
    const uuidHyphen = addHyphens(uuid);



    const prefix = playerJson.data.prefix || "";
    const name = playerJson.data.name || playerJson.data.username || username;
    const nameWithPrefix = playerJson.data.stats?.nameWithPrefix || playerJson.data.nameWithPrefix || (prefix ? `${prefix} ${name}` : name);
    const formattedName = minecraftColorToHtml(nameWithPrefix);



    // Set skin preview
    avatarImg.src = `https://skin.laby.net/api/render/user/${uuidHyphen}.png?shadow=true&bust=true`;



    // Minigame Stats (from player data)
    const ach = playerJson.data.achievements || {};
    const skywarsStars = ach.skywars_you_re_a_star || 0;
    const arcadeCoins = ach.arcade_arcade_banker || 0;
    const bedwarsStars = ach.bedwars_level || 0;
    const uhcBounty = ach.uhc_bounty || 0;
    const pitGold = ach.pit_gold || 0;



    // 2. Fetch SkyBlock Data (all profiles, with networth)
    const skyRes = await fetch(`https://soopy.dev/api/v2/player_skyblock/${uuid}?networth=true`);
    const skyJson = await skyRes.json();
    
    // --- BEST PROFILE SELECTION LOGIC ---
    let bestMember = null;
    let bestCuteName = "N/A";
    let maxScore = -1;
    let profilesData = skyJson.data?.profiles || {};

    for (const profileId in profilesData) {
        const profile = profilesData[profileId];
        const member = profile.members?.[uuid];
        
        if (member) {
            // Get key stats for scoring
            const networth = member.nwDetailed?.networth || 0;
            const skillAvg = getSkillAverage(member);
            const sbLvl = member.skyblock_level || 0;

            // Simple Scoring Formula (Networth is the primary factor)
            const score = (networth / 1000000) * 100 + (skillAvg * 100) + (sbLvl * 10);
            
            if (score > maxScore) {
                maxScore = score;
                bestMember = member;
                bestCuteName = profile.stats?.cute_name || profile.stats?.profile_name || "Unknown Profile";
            }
        }
    }
    // --- END PROFILE SELECTION LOGIC ---

    // 3. Use the Best Profile Data for Output
    let coins = 0, kills = 0, fairy = 0, types = {}, networth = 0, sbLvl = 0;
    let avgSkillLevel = 0;
    
    if (bestMember) {
        coins = bestMember.coin_purse || 0;
        kills = bestMember.kills?.total || 0;
        fairy = bestMember.fairy_souls_collected || 0;
        sbLvl = bestMember.skyblock_level || 0;
        types = bestMember.nwDetailed?.types || {};
        networth = bestMember.nwDetailed?.networth || 0;
        avgSkillLevel = getSkillAverage(bestMember).toFixed(2);
        
        if (networth === 0 && coins > 0) {
            networth = coins;
        }
    }


    const collectItems = (t) => (t?.items?.length ? t.items.map(i => cleanName(i.name)) : []);
    const sections = [
      ...collectItems(types.armor),
      ...collectItems(types.equipment),
      ...collectItems(types.wardrobe),
      ...collectItems(types.weapons),
      ...collectItems(types.inventory)
    ];
    // Filter out any entries that ended up empty after cleaning (e.g., if an item name was ONLY 'apis')
    const itemList = sections.filter(item => item).join(", ");


    // 4. Generate Final Output String
    const parts = [];
    
    if (networth > 0) parts.push(`NW: ${formatCoins(networth)}`);
    if (coins > 0) parts.push(`Purse: ${formatCoins(coins)}`);
    if (avgSkillLevel > 0) parts.push(`Avg_Skill: ${avgSkillLevel}`);
    if (skywarsStars > 0) parts.push(`SW: ${skywarsStars}`);
    if (bedwarsStars > 0) parts.push(`BW: ${bedwarsStars}`);
    if (pitGold > 0) parts.push(`Pit_Gold: ${formatCoins(pitGold)}`);
    if (uhcBounty > 0) parts.push(`UHC_Bounty: ${formatCoins(uhcBounty)}`);
    if (sbLvl > 0) parts.push(`Sb_Lvl: ${sbLvl}`);
    if (arcadeCoins > 0) parts.push(`Arcade_Coins: ${formatCoins(arcadeCoins)}`);
    
    // Add additional stats
    if (kills > 0) parts.push(`Sb_Kills: ${kills}`);
    if (fairy > 0) parts.push(`Sb_Fairy_Souls: ${fairy}`);
    if (itemList) parts.push(`Sb_Valuable_Items: ${itemList}`);
    

    oneLine.innerHTML = formattedName || name;
    profileNameOutput.textContent = `(Best Profile: ${bestCuteName})`;
    
    // Final output is JUST the stats string
    out.textContent = parts.join(" ") 
        || "No significant stats found for this player/profile.";

  } catch (err) {

    console.error(err);

    out.textContent = "âŒ Failed to fetch stats. Check console for details or ensure the username is correct.";

    oneLine.textContent = "â€”";
    profileNameOutput.textContent = "";

  }

}



document.getElementById('refreshBtn').addEventListener('click', fetchStats);

document.getElementById('uuidInput').addEventListener('keypress', e => {

  if (e.key === 'Enter') fetchStats();

});

</script>

</body>

</html>
